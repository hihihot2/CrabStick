<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	 
<mapper namespace="com.crabstick.myapp.plan.PlanMapper">

	<resultMap type="com.crabstick.myapp.plan.Plan" id="PlanResultMap">
		<result property="plan_no" column="plan_no"/>
		<result property="plan_name" column="plan_name"/>
		<result property="plan_commt" column="plan_commt" />
		<result property="plan_cost" column="plan_cost" />
		<result property="plan_persons" column="plan_persons" />
		<result property="plan_writedate" column="plan_writedate" />
		<result property="plan_style" column="plan_style" />
		<result property="mem_no" column="mem_no" />
		<result property="loc_no" column="loc_no" />
	</resultMap>	
	<resultMap type="com.crabstick.myapp.location.Location" id="LocationResultMap">
		<result property="loc_no" column="loc_no"/>
		<result property="loc_name" column="loc_name"/>
		<result property="loc_lati" column="loc_lati"/>
		<result property="loc_long" column="loc_long"/>
		<result property="loc_ctweight" column="loc_ctweight"/>
		<result property="loc_hiweight" column="loc_hiweight"/>
		<result property="loc_ntwegith" column="loc_ntweight"/>
		<result property="loc_code" column="loc_code"/>
		<result property="loc_siguncode" column="loc_siguncode"/>
		<result property="loc_imgpath" column="loc_imgpath"/>
		<result property="loc_commt" column="loc_commt"/>
	</resultMap>	

	<insert id="insert" parameterType="com.crabstick.myapp.plan.PlanMapper">
		INSERT INTO plans VALUES(SEQ_PLAN.NEXTVAL, #{plan_name}, #{plan_commt}, #{plan_cost}, #{plan_persons}, SYSDATE, #{plan_style}, #{mem_no}, #{loc_no})
		
		<selectKey keyProperty="plan_no" resultType="Integer" order="AFTER">
			SELECT SEQ_PLAN.CURRVAL FROM DUAL
		</selectKey>
	</insert>	
	
	<select id="select" parameterType="int" resultMap="PlanResultMap">
		SELECT * FROM plans WHERE mem_no=#{mem_no} ORDER BY plan_no desc
	</select>
	
	<select id="selectplan" parameterType="int" resultMap="PlanResultMap">
		SELECT * FROM plans WHERE plan_no=#{plan_no}	
	</select>
		
	<select id="recent_select" resultMap="PlanResultMap">
		SELECT * FROM (SELECT * FROM PLANS ORDER BY PLAN_WRITEDATE DESC) WHERE <![CDATA[ ROWNUM<=3]]>
	</select>
	
	<select id='update' parameterType="com.crabstick.myapp.plan.PlanMapper">
		UPDATE plans SET plan_name = #{plan_name}, plan_commt = #{plan_commt}, plan_cost = #{plan_cost}, plan_persons = #{plan_persons}, plan_writedate = SYSDATE, plan_style = #{plan_style} WHERE plan_no = #{plan_no}
	</select>
	
	<select id="selectLocationByPlanNo" parameterType="int" resultMap="LocationResultMap">
		SELECT l.loc_no AS loc_no, loc_name, loc_lati, loc_long, loc_ctweight, loc_hiweight, loc_ntweight, loc_code, loc_siguncode, loc_imgpath, loc_commt
		FROM locations l, plans p WHERE p.loc_no = l.loc_no AND p.plan_no = ${plan_no}
	</select>
</mapper>
